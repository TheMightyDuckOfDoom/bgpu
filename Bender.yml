# Copyright 2025 Tobias Senti
# Solderpad Hardware License, Version 0.51, see LICENSE for details.
# SPDX-License-Identifier: SHL-0.51

package:
    name: BGPU
    authors:
        - "Tobias Senti <git@tsenti.li>"

dependencies:
    axi:                { git: "https://github.com/pulp-platform/axi",                version: 0.39.8           }
    common_cells:       { git: "https://github.com/pulp-platform/common_cells",       version: 1.38.0           }
    obi:                { git: "https://github.com/pulp-platform/obi",                version: 0.1.7            }
    register_interface: { git: "https://github.com/TheMightyDuckOfDoom/register_interface", rev: "fix-reg2axi"  }
    riscv-dbg:          { git: "https://github.com/pulp-platform/riscv-dbg.git",      rev: "verilator-phsauter" }
    tech_cells_generic: { git: "https://github.com/pulp-platform/tech_cells_generic", version: 0.2.13           }
    # hpdcache:     { git: "https://github.com/openhwgroup/cv-hpdcache",    rev: 724dcede54123f69bfac64842d8ee52833d4fd77 }

sources:
    - rtl/bgpu_pkg.sv

    - target: not(any(post_synth, post_layout))
      files:
          - rtl/compute_unit/fetcher/warp_its_unit.sv
          - rtl/compute_unit/fetcher/multi_warp_its_unit.sv
          - rtl/compute_unit/fetcher/fetcher.sv

          - rtl/compute_unit/instruction_cache.sv
          - rtl/compute_unit/decoder.sv
      
          - rtl/compute_unit/dispatcher/tag_queue.sv
          - rtl/compute_unit/dispatcher/reg_table.sv
          - rtl/compute_unit/dispatcher/wait_buffer.sv
          - rtl/compute_unit/dispatcher/dispatcher.sv
          - rtl/compute_unit/dispatcher/multi_warp_dispatcher.sv

          - rtl/compute_unit/register_opc/register_file_bank.sv
          - rtl/compute_unit/register_opc/operand_collector.sv
          - rtl/compute_unit/register_opc/register_indexer.sv
          - rtl/compute_unit/register_opc/register_opc_stage.sv

          - rtl/compute_unit/execution_units/integer_unit.sv

          - rtl/compute_unit/execution_units/load_store_unit/coalesce_comparator.sv
          - rtl/compute_unit/execution_units/load_store_unit/coalesce_splitter.sv
          - rtl/compute_unit/execution_units/load_store_unit/wdata_assembler.sv
          - rtl/compute_unit/execution_units/load_store_unit/load_store_unit.sv

          - rtl/compute_unit/execution_units/branch_unit.sv

          - rtl/compute_unit/compute_unit.sv

          - rtl/compute_cluster/imem_to_axi.sv
          - rtl/compute_cluster/mem_to_axi.sv
          - rtl/compute_cluster/compute_cluster.sv
          - rtl/compute_cluster/compute_cluster_synth_wrapper.sv

          - rtl/bgpu_soc/thread_dispatcher.sv
          - rtl/bgpu_soc/obi_thread_engine.sv
          - rtl/bgpu_soc/bgpu_soc.sv

    - target: any(sim, gowin_sim, xilinx_sim)
      files:
          - test/util/rand_stream_mst.sv
          - test/util/rand_synch_holdable_driver.sv
          - test/util/rand_stream_slv.sv
          - test/util/axi_sim_mem.sv
          - test/util/axi_dumper.sv
          - test/util/jtag_driver_simple_bgpu.sv

    - target: sim
      files:
          - test/tb_tag_queue.sv

          - test/tb_register_file_bank.sv
          - test/tb_operand_collector.sv
          - test/tb_register_opc_stage.sv

          - test/tb_coalesce_comparator.sv
          - test/tb_coalesce_splitter.sv
          - test/tb_wdata_assembler.sv
          - test/tb_load_store_unit.sv

          - test/tb_instruction_cache.sv

          - test/tb_compute_unit.sv

          - test/tb_compute_cluster.sv

          - test/tb_thread_dispatcher.sv
          - test/tb_bgpu_soc.sv

    - target: asic
      files:
          - asic/lib/tc_clk.sv
          - asic/lib/tc_sram.sv

    - target: gowin_postsynth
      defines:
          POST: ~
      files:
          - gowin/lib/cells_sim.v
          - gowin/lib/prim_sim.v
          - gowin/out/post_synth.v

    - target: gowin_sim
      files:
          - gowin/lib/prim_sim.v
          - test/tb_register_file_bank.sv
          - test/tb_register_opc_stage.sv
          - test/tb_instruction_cache.sv
          - test/tb_compute_unit.sv
          - test/tb_bgpu_soc.sv
      
    - target: any(gowin_yosys, gowin_eda, gowin_sim)
      files:
          - gowin/tc_sram.sv

    - target: gowin_yosys
      files:
          - gowin/lib/blackbox.v

    - target: xilinx_sim
      files:
          - xilinx/lib/cells_sim.v
          - xilinx/lib/RAMB36E1.v
          - test/tb_register_file_bank.sv
          - test/tb_register_opc_stage.sv
          - test/tb_instruction_cache.sv
          - test/tb_compute_unit.sv
          - test/tb_bgpu_soc.sv

    - target: xilinx_yosys
      files:
          - xilinx/lib/blackbox.v
    
    - target: xilinx_postsynth
      defines:
          POST: ~
      files:
          - /usr/local/share/yosys/simlib.v
          - xilinx/lib/cells_sim.v
          - xilinx/lib/RAMB36E1.v
          - xilinx/out/post_synth.v

    - target: any(xilinx, xilinx_yosys, xilinx_sim)
      files:
          - xilinx/lib/tc_clk.sv
          - xilinx/lib/tc_sram.sv
